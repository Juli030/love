<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Est√° preparada para o poss√≠vel in√≠cio da nossa turn√™? üé∏</title>

  <style>
    :root{
      --bg1:#07060a;
      --bg2:#150015;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --shadow: 0 18px 60px rgba(0,0,0,.62);
      --radius: 18px;

      --hot:#ff2d55;
      --glow: 0 0 22px rgba(255,45,85,.55);

      --gold:#ffd36a;
      --silver:#cfd6e6;
    }

    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 520px at 20% 10%, rgba(255,45,85,.18) 0%, transparent 55%),
        radial-gradient(800px 520px at 80% 20%, rgba(255,211,106,.10) 0%, transparent 60%),
        radial-gradient(700px 520px at 50% 90%, rgba(166,83,255,.10) 0%, transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    /* brilhinhos sutis no fundo */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.35) 50%, transparent 55%),
        radial-gradient(2px 2px at 70% 20%, rgba(255,255,255,.25) 50%, transparent 55%),
        radial-gradient(1px 1px at 40% 80%, rgba(255,255,255,.20) 50%, transparent 55%),
        radial-gradient(1px 1px at 85% 75%, rgba(255,255,255,.18) 50%, transparent 55%);
      opacity: .55;
      filter: blur(.2px);
      animation: twinkle 3.5s infinite alternate ease-in-out;
    }
    @keyframes twinkle{
      from{ opacity: .40; transform: translateY(0); }
      to{ opacity: .70; transform: translateY(-2px); }
    }

    .topbar{
      position:fixed; inset:18px 18px auto 18px;
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      z-index:3;
      pointer-events:none;
    }
    .brand, .counter{ pointer-events:auto; }

    .brand{
      display:flex; gap:10px; align-items:center;
      padding:10px 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(10px);
      border-radius:999px;
      box-shadow: var(--shadow);
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: var(--hot);
      box-shadow: var(--glow);
    }
    .brand small{color:var(--muted)}
    .counter{
      padding:10px 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      backdrop-filter: blur(10px);
      border-radius:999px;
      box-shadow: var(--shadow);
      color:var(--muted);
      font-variant-numeric: tabular-nums;
      display:flex;
      align-items:center;
      gap:10px;
    }

    /* bot√£o som */
    .soundBtn{
      pointer-events:auto;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding:7px 10px;
      border-radius: 999px;
      cursor:pointer;
      transition:.2s transform, .2s background;
      font-size: 12px;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .soundBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.12); }

    .stage{
      position:relative;
      width:100vw; height:100vh;
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }

    .hint{
      max-width:720px;
      text-align:center;
      padding:18px 18px 22px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .hint h1{
      margin:0 0 8px;
      font-size: clamp(20px, 4vw, 34px);
      letter-spacing: .3px;
      text-transform: uppercase;
    }
    .hint p{
      margin:0;
      color:var(--muted);
      line-height:1.55;
      font-size: clamp(14px, 2.5vw, 16px);
    }
    .hint button{
      margin-top:14px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,45,85,.16);
      color:var(--text);
      padding:10px 14px;
      border-radius: 999px;
      cursor:pointer;
      transition:.2s transform, .2s background;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    .hint button:hover{ transform: translateY(-1px); background: rgba(255,45,85,.22); }

    /* Popups */
    .popup{
      position:absolute;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(16, 10, 20, .72);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
      user-select:none;
      animation: pop .18s ease-out;
    }
    @keyframes pop{
      from{ transform: scale(.96); opacity:0; }
      to{ transform: scale(1); opacity:1; }
    }

    /* Glitter border vibe */
    .popup::before{
      content:"";
      position:absolute; inset:0;
      padding:1px;
      border-radius:22px;
      background: linear-gradient(135deg,
        rgba(255,45,85,.70),
        rgba(255,211,106,.55),
        rgba(255,255,255,.30),
        rgba(255,45,85,.55)
      );
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
      opacity:.62;
    }

    .popup .head{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 12px;
      background: rgba(255,255,255,.06);
      border-bottom:1px solid rgba(255,255,255,.10);
      cursor:grab;
    }
    .popup .title{
      display:flex; gap:10px; align-items:center;
      font-weight:800;
      font-size: 12px;
      letter-spacing: .8px;
      text-transform: uppercase;
      color: rgba(255,255,255,.88);
    }

    .badge{
      font-size:11px;
      padding:4px 8px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.78);
    }

    .traffic{ display:flex; gap:6px; align-items:center; }
    .traffic i{
      display:block; width:10px; height:10px; border-radius:50%;
      opacity:.9;
    }
    .traffic i:nth-child(1){ background:#ff5f57; }
    .traffic i:nth-child(2){ background:#febc2e; }
    .traffic i:nth-child(3){ background:#28c840; }

    .popup .body{
      padding:14px 14px 10px;
      color: rgba(255,255,255,.92);
      line-height:1.55;
      font-size: 15px;
    }

    .popup .body .tiny{
      display:block;
      margin-top:10px;
      color: rgba(255,255,255,.62);
      font-size: 12px;
      letter-spacing: .3px;
    }

    .popup .foot{
      display:flex; justify-content:space-between; gap:10px;
      padding:0 12px 12px;
      align-items:center;
    }

    .spark{
      font-size: 12px;
      color: rgba(255,255,255,.65);
      display:flex;
      gap:8px;
      align-items:center;
    }

    .btn{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding:8px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition:.2s transform, .2s background;
      font-size: 13px;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.12); }
    .btn.primary{
      border-color: rgba(255,45,85,.55);
      background: rgba(255,45,85,.18);
      box-shadow: 0 0 0 1px rgba(255,45,85,.10), 0 0 26px rgba(255,45,85,.12);
    }
    .btn.primary:hover{ background: rgba(255,45,85,.26); }

    /* Big popup */
    .popup.big{
      width: min(820px, calc(100vw - 40px));
      border-radius: 28px;
    }
    .popup.big::before{ border-radius: 28px; opacity:.75; }
    .popup.big .head{ padding: 12px 14px; }
    .bigText{ padding: 22px 18px 6px; text-align:center; }
    .bigText .line1{
      font-weight: 900;
      font-size: clamp(22px, 5vw, 44px);
      letter-spacing: .6px;
      text-transform: uppercase;
    }
    .bigText .line2{
      margin-top: 10px;
      font-size: clamp(14px, 2.5vw, 18px);
      color: rgba(255,255,255,.72);
    }
    .bigText .heart{
      display:inline-block;
      margin-top: 12px;
      font-size: 28px;
      filter: drop-shadow(0 0 18px rgba(255,45,85,.35));
    }

    /* Final overlay (pedido) */
    .overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding:24px;
      background: rgba(0,0,0,.60);
      backdrop-filter: blur(7px);
      z-index:10;
    }
    .final{
      width:min(560px, 100%);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(16, 10, 20, .78);
      border-radius: 26px;
      box-shadow: var(--shadow);
      padding:18px 18px 16px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .final::before{
      content:"";
      position:absolute; inset:-40%;
      background: radial-gradient(circle, rgba(255,45,85,.20) 0%, transparent 60%);
      transform: rotate(18deg);
      pointer-events:none;
    }
    .final h2{
      position:relative;
      margin:8px 0 6px;
      font-size: clamp(20px, 5vw, 34px);
      text-transform: uppercase;
      letter-spacing:.6px;
    }
    .final p{
      position:relative;
      margin:0 0 14px;
      color: var(--muted);
      line-height:1.5;
      font-size: 15px;
    }

    /* ‚úÖ ALTERADO: mais altura pra pista do bot√£o fugir */
    .actions{
      position:relative;
      display:flex; justify-content:center; gap:10px; flex-wrap:wrap;
      margin-top: 10px;
      min-height: 70px;
      padding-top: 10px;
    }

    .smallnote{
      position:relative;
      margin-top:10px;
      font-size: 12px;
      color: rgba(255,255,255,.60);
    }

    /* ‚úÖ ALTERADO: s√≥ vira absoluto quando estiver fugindo */
    #thinkBtn.is-dodging{
      position:absolute;
      will-change: left, top;
      touch-action: none;
    }

    /* ENCORE overlay (s√≥ no SIM) */
    .encoreOverlay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      padding:24px;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(8px);
      z-index:20;
    }
    .encoreCard{
      width:min(820px, 100%);
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border-radius: 28px;
      box-shadow: 0 18px 60px rgba(0,0,0,.65), 0 0 40px rgba(255,45,85,.16);
      padding: 22px 18px 18px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .encoreCard::before{
      content:"";
      position:absolute; inset:-35%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,45,85,.22) 0%, transparent 58%),
        radial-gradient(circle at 75% 20%, rgba(255,211,106,.12) 0%, transparent 60%),
        radial-gradient(circle at 50% 80%, rgba(255,255,255,.10) 0%, transparent 60%);
      transform: rotate(12deg);
      pointer-events:none;
    }
    .encoreBadge{
      position:relative;
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      letter-spacing:.9px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.92);
      box-shadow: 0 0 20px rgba(255,45,85,.14);
    }
    .encoreTitle{
      position:relative;
      margin:14px 0 10px;
      font-size: clamp(24px, 3.8vw, 46px);
      line-height:1.12;
      text-transform: uppercase;
      letter-spacing:.6px;
      text-shadow: 0 0 24px rgba(255,45,85,.16);
    }
    .encoreSub{
      position:relative;
      margin:0 0 14px;
      color: rgba(255,255,255,.78);
      line-height:1.5;
      font-size: 15px;
    }

    /* ===== SHOW LIGHTS (s√≥ no ENCORE) ===== */
    .showLights{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      border-radius: 28px;
      z-index: 0;
    }
    .beam{
      position:absolute;
      top:-40%;
      width: 140px;
      height: 220%;
      opacity:.55;
      filter: blur(0.2px);
      transform-origin: top center;
      mix-blend-mode: screen;
      background: linear-gradient(to bottom,
        rgba(255,255,255,.0) 0%,
        rgba(255,45,85,.25) 25%,
        rgba(255,211,106,.18) 55%,
        rgba(255,255,255,.0) 100%
      );
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      animation: sweep 2.6s ease-in-out infinite alternate;
    }
    .beam.b1{ left: 10%; animation-duration: 2.2s; transform: rotate(-12deg); opacity:.45; }
    .beam.b2{ left: 35%; animation-duration: 2.8s; transform: rotate(8deg);  opacity:.55; }
    .beam.b3{ left: 60%; animation-duration: 2.4s; transform: rotate(-6deg); opacity:.50; }
    .beam.b4{ left: 82%; animation-duration: 3.0s; transform: rotate(14deg); opacity:.42; }

    @keyframes sweep{
      0%   { transform: rotate(-16deg) translateY(0); opacity:.35; }
      50%  { transform: rotate(10deg) translateY(6px); opacity:.55; }
      100% { transform: rotate(-8deg) translateY(0); opacity:.40; }
    }

    .spot{
      position:absolute;
      top: -40px;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      filter: blur(6px);
      opacity:.35;
      mix-blend-mode: screen;
      animation: floaty 2.8s ease-in-out infinite alternate;
      background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.55), rgba(255,45,85,.18), transparent 65%);
    }
    .spot.s1{ left: 6%;  animation-duration: 2.4s; }
    .spot.s2{ left: 40%; animation-duration: 3.0s; opacity:.28; }
    .spot.s3{ left: 72%; animation-duration: 2.6s; }

    @keyframes floaty{
      from{ transform: translateY(0) scale(1); }
      to  { transform: translateY(14px) scale(1.06); }
    }

    .strobe{
      position:absolute;
      inset:0;
      background: rgba(255,255,255,.08);
      opacity:0;
      animation: strobe 1.2s linear infinite;
      mix-blend-mode: screen;
    }
    @keyframes strobe{
      0%, 86%, 100% { opacity: 0; }
      88% { opacity: .32; }
      90% { opacity: 0; }
      92% { opacity: .18; }
      94% { opacity: 0; }
    }

    .encoreCard > *:not(.showLights){
      position: relative;
      z-index: 1;
    }

    /* ===== INTRO KISS (tela de abertura) ===== */
    .intro{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: grid;
      place-items: center;
      background:
        radial-gradient(1200px 600px at 50% 0%, rgba(255,0,60,.22), transparent 60%),
        radial-gradient(900px 500px at 15% 70%, rgba(255,210,80,.12), transparent 60%),
        radial-gradient(900px 500px at 85% 70%, rgba(255,45,85,.10), transparent 60%),
        linear-gradient(180deg, #05040a, #120012 60%, #07060a);
      overflow: hidden;
    }

    .intro__fx{
      position: absolute;
      inset: -30%;
      background:
        radial-gradient(circle at 20% 30%, rgba(255,45,85,.30), transparent 45%),
        radial-gradient(circle at 80% 35%, rgba(255,215,120,.22), transparent 48%),
        radial-gradient(circle at 50% 75%, rgba(255,255,255,.06), transparent 55%);
      filter: blur(10px);
      animation: introGlow 3.4s ease-in-out infinite alternate;
    }

    @keyframes introGlow{
      from { transform: scale(1) rotate(-2deg); opacity: .75; }
      to   { transform: scale(1.04) rotate(2deg); opacity: 1; }
    }

    .intro__content{
      position: relative;
      width: min(720px, 92vw);
      padding: 28px 22px;
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 22px;
      background: rgba(255,255,255,.06);
      box-shadow: 0 22px 80px rgba(0,0,0,.62);
      text-align: center;
      backdrop-filter: blur(10px);
    }

    .intro__badge{
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      letter-spacing: .14em;
      font-size: 12px;
      color: rgba(255,255,255,.82);
      text-transform: uppercase;
    }

    .intro__title{
      margin: 14px 0 6px;
      font-size: clamp(28px, 4vw, 44px);
      line-height: 1.1;
      color: rgba(255,255,255,.95);
      text-shadow: 0 0 22px rgba(255,45,85,.35);
    }

    .intro__subtitle{
      margin: 0 0 18px;
      color: rgba(255,255,255,.78);
    }

    .intro__btn{
      appearance: none;
      border: 1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(255,45,85,.92), rgba(180,10,55,.92));
      color: white;
      padding: 12px 18px;
      border-radius: 14px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 18px 50px rgba(255,45,85,.22);
      transform: translateY(0);
      transition: transform .18s ease, filter .18s ease;
    }

    .intro__btn:hover{ transform: translateY(-2px); filter: brightness(1.06); }
    .intro__btn:active{ transform: translateY(0); }

    .intro__hint{
      display: block;
      margin-top: 12px;
      color: rgba(255,255,255,.60);
    }

    .intro--hide{ animation: introOut .35s ease forwards; }
    @keyframes introOut{
      to { opacity: 0; transform: scale(1.02); pointer-events: none; }
    }
  </style>
</head>

<body>
  <!-- INTRO -->
  <div id="kissIntro" class="intro">
    <div class="intro__fx"></div>
    <div class="intro__content">
      <div class="intro__badge">TURN√ä ESPECIAL</div>
      <h1 class="intro__title">I Was Made For Lovin‚Äô You</h1>
      <p class="intro__subtitle">Uma √∫nica apresenta√ß√£o. Um √∫nico ‚Äúsim‚Äù.</p>

      <button id="btnEnterShow" class="intro__btn">
        üéüÔ∏è Entrar no Show
      </button>

      <small class="intro__hint">Dica: som ligado deixa tudo mais √©pico üé∏</small>
    </div>
  </div>

  <audio id="bgMusic" preload="auto" loop>
    <source src="made_for_lovin_you.mp3" type="audio/mpeg">
  </audio>

  <!-- Efeitos -->
  <audio id="crowdCheer" preload="auto">
    <source src="crowd_cheer.mp3" type="audio/mpeg">
  </audio>

  <audio id="applause" preload="auto">
    <source src="applause.mp3" type="audio/mpeg">
  </audio>

  <div class="topbar">
    <div class="brand">
      <span class="dot"></span>
      <div>
        <div style="font-weight:900; font-size:13px; letter-spacing:.7px; text-transform:uppercase;">Tour do Cora√ß√£o</div>
        <small>Feche todos os pop-ups pra desbloquear o final</small>
      </div>
    </div>

    <div class="counter" id="counter">
      <span>0/0</span>
      <button class="soundBtn" id="soundBtn" title="Ativar/pausar m√∫sica">
        üîá <span id="soundLabel">Som</span>
      </button>
    </div>
  </div>

  <div class="stage">
    <div class="hint" id="hint">
      <h1>Est√° preparada para o poss√≠vel in√≠cio da nossa turn√™? üé∏</h1>
      <p>Vai chover pop-up. Fecha tudo e eu te mostro o √∫ltimo. <br/></p>
      <button id="startBtn">Iniciar o Show ü§ò</button>
    </div>
  </div>

  <!-- Overlay final (pedido) -->
  <div class="overlay" id="overlay">
    <div class="final">
      <div style="font-size:34px; position:relative;">üíò</div>
      <h2>Aceita namorar cmg minha chatinha?</h2>
      <p>
        Eu n√£o consigo prometer perfei√ß√£o, mas consigo prometer presen√ßa,
        carinho e um abrigo so seu ao meu lado para o resto de nossas vidas.
      </p>
      <div class="actions" id="finalActions">
        <button class="btn primary" id="yesBtn">Sim</button>
        <button class="btn" id="thinkBtn" type="button">Preciso pensar</button>
      </div>
      <div class="smallnote" id="note"></div>
    </div>
  </div>

  <!-- ENCORE: aparece s√≥ se clicar SIM -->
  <div class="encoreOverlay" id="encoreOverlay">
    <div class="encoreCard">
      <div class="showLights" aria-hidden="true">
        <div class="spot s1"></div>
        <div class="spot s2"></div>
        <div class="spot s3"></div>

        <div class="beam b1"></div>
        <div class="beam b2"></div>
        <div class="beam b3"></div>
        <div class="beam b4"></div>

        <div class="strobe"></div>
      </div>

      <div class="encoreBadge">ENCORE üíã</div>
      <div class="encoreTitle">
        Esse ingresso n√£o √© s√≥ lembran√ßa.<br/>
        √â o come√ßo da nossa turn√™ juntos.
      </div>
      <div class="encoreSub">Agora oficialmente nossa turn√™ se inicia. üñ§üé∏</div>
      <div class="actions">
        <button class="btn primary" id="encoreClose">OK, minha estrela ‚≠ê</button>
      </div>
      <div class="smallnote">ps: essa parte s√≥ aparece no ‚ÄúSim‚Äù üòå</div>
    </div>
  </div>

  <script>
    // ‚ú® PERSONALIZE AQUI ‚ú®
    const messages = [
      "Voc√™ tem um jeito raro de deixar tudo mais bonito s√≥ por existir.",
      "Eu gosto de voc√™ no detalhe: no riso, na calma, no jeitinho.",
      "Se eu fosse m√∫sica, eu ia querer ser a sua favorita.",
      "Voc√™ √© aquela parte do meu dia que eu espero sem perceber.",
      "Quando voc√™ aparece, at√© o sil√™ncio fica confort√°vel.",
      "Eu gosto do jeito que voc√™ cuida do mundo, mesmo sem notar.",
      "Tem carinho em voc√™ que parece luz acesa.",
      "Eu penso em voc√™ e meu peito fica mais leve. Isso √© injusto (e √≥timo).",
      "Voc√™ √© a prova viva de que o simples pode ser incr√≠vel.",
      "Eu gosto de voc√™ com uma certeza calma, daquelas que aquecem.",
      "Se eu pudesse, eu te guardava num lugar seguro: bem aqui comigo.",
      "Voc√™ faz meu c√©rebro virar confete e minha voz virar sorriso.",
      "Voc√™ √© meu tipo de caos bom: o que melhora tudo.",
      "Eu queria te dizer isso pessoalmente, mas achei mais divertido assim.",
      "Voc√™ merece um amor que n√£o some, n√£o hesita, n√£o economiza.",
      "Obrigada por existir do jeitinho que existe (sim, eu gosto muito).",
      "Se o mundo fosse uma playlist, voc√™ seria a m√∫sica que eu repito.",
      "Meu cora√ß√£o pediu para avisar: ele gosta de voc√™ faz tempo.",
      "Voc√™ √© meu pensamento favorito quando eu deveria estar focando.",
      "Seu nome combina com a palavra ‚Äòcasa‚Äô.",
      "Ok‚Ä¶ t√° ficando s√©rio. Continua fechando. üëÄ",
      "Quase l√°. √öltima fase chegando. üíã",
    ];

    const TARGET_POPUPS = 22;
    const POPUPS_DELAY_MS = 80;

    const BIG_POPUP_TEXT = "I was made for lovin‚Äô you baby";
    const BIG_POPUP_SUB  = "Agora fecha esse e v√™ o que eu queria te perguntar‚Ä¶";

    const stage = document.querySelector(".stage");
    const startBtn = document.getElementById("startBtn");
    const hint = document.getElementById("hint");
    const overlay = document.getElementById("overlay");
    const counter = document.getElementById("counter");
    const note = document.getElementById("note");
    const yesBtn = document.getElementById("yesBtn");
    const thinkBtn = document.getElementById("thinkBtn");
    const finalActions = document.getElementById("finalActions");

    const bgMusic = document.getElementById("bgMusic");
    const soundBtn = document.getElementById("soundBtn");
    const soundLabel = document.getElementById("soundLabel");
    let soundOn = false;

    const crowdCheer = document.getElementById("crowdCheer");
    const applause = document.getElementById("applause");

    function playSfxSafe(audioEl, { volume = 0.7 } = {}){
      if(!audioEl) return;
      try{
        audioEl.pause();
        audioEl.currentTime = 0;
        audioEl.volume = volume;
        audioEl.play().catch(()=>{});
      }catch(e){}
    }

    function setSoundUI(){
      soundBtn.firstChild.textContent = soundOn ? "üîä " : "üîá ";
      soundLabel.textContent = soundOn ? "Pausar" : "Som";
      soundBtn.setAttribute("aria-pressed", soundOn ? "true" : "false");
    }

    async function toggleSound(){
      try{
        if(!soundOn){
          bgMusic.volume = 0.35;
          await bgMusic.play();
          soundOn = true;
        }else{
          bgMusic.pause();
          soundOn = false;
        }
        setSoundUI();
      }catch(e){
        soundOn = false;
        setSoundUI();
      }
    }

    soundBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleSound();
    });

    // INTRO
    const kissIntro = document.getElementById("kissIntro");
    const btnEnterShow = document.getElementById("btnEnterShow");

    btnEnterShow?.addEventListener("click", async () => {
      try{
        bgMusic.volume = 0.35;
        await bgMusic.play();
        soundOn = true;
        setSoundUI();
      }catch(e){}
      kissIntro.classList.add("intro--hide");
      setTimeout(() => kissIntro.remove(), 400);
    });

    let closedCount = 0;
    let z = 5;
    let totalToClose = 0;

    function updateCounter(){
      const remaining = Math.max(0, totalToClose - closedCount);
      counter.querySelector("span").textContent = `${remaining}/${totalToClose}`;
    }

    function rand(min, max){ return Math.random() * (max - min) + min; }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function placeOnScreen(el, wGuess=360, hGuess=180){
      const maxX = Math.max(10, window.innerWidth - 10 - wGuess);
      const maxY = Math.max(70, window.innerHeight - 10 - hGuess);
      const x = rand(10, maxX);
      const y = rand(70, maxY);
      el.style.left = `${x}px`;
      el.style.top  = `${y}px`;
    }

    function createPopup(text, idx){
      const el = document.createElement("div");
      el.className = "popup";
      el.style.zIndex = z++;
      el.style.width = `${Math.floor(rand(300, 380))}px`;

      el.innerHTML = `
        <div class="head">
          <div class="title">
            <span>LOVE POP-UP</span>
            <span class="badge">#${String(idx+1).padStart(2,"0")}</span>
          </div>
          <div class="traffic" aria-hidden="true"><i></i><i></i><i></i></div>
        </div>
        <div class="body">
          ${escapeHtml(text)}
          <span class="tiny">feche para continuar ‚ú¶</span>
        </div>
        <div class="foot">
          <div class="spark">üíã <span style="opacity:.75">KISS vibes</span></div>
          <button class="btn primary" data-action="close">Fechar</button>
        </div>
      `;

      stage.appendChild(el);
      const rect = el.getBoundingClientRect();
      placeOnScreen(el, rect.width, rect.height);

      el.addEventListener("mousedown", () => el.style.zIndex = z++);

      el.querySelector('[data-action="close"]').addEventListener("click", () => {
        el.remove();
        closedCount++;
        updateCounter();
        checkProgress();
      });

      dragElement(el, el.querySelector(".head"));
      return el;
    }

    function createBigPopup(){
      const el = document.createElement("div");
      el.className = "popup big";
      el.style.zIndex = z++;

      el.innerHTML = `
        <div class="head">
          <div class="title">
            <span>FINAL TRACK</span>
            <span class="badge">SPECIAL</span>
          </div>
          <div class="traffic" aria-hidden="true"><i></i><i></i><i></i></div>
        </div>
        <div class="bigText">
          <div class="line1">${escapeHtml(BIG_POPUP_TEXT)}</div>
          <div class="line2">${escapeHtml(BIG_POPUP_SUB)}</div>
          <div class="heart">üíò</div>
        </div>
        <div class="foot">
          <div class="spark">üé∏ <span style="opacity:.75">close pra revelar</span></div>
          <button class="btn primary" data-action="close">Fechar</button>
        </div>
      `;

      stage.appendChild(el);

      const rect = el.getBoundingClientRect();
      el.style.left = `${Math.max(10, (window.innerWidth - rect.width)/2)}px`;
      el.style.top  = `${Math.max(80, (window.innerHeight - rect.height)/2)}px`;

      el.addEventListener("mousedown", () => el.style.zIndex = z++);

      el.querySelector('[data-action="close"]').addEventListener("click", () => {
        el.remove();
        closedCount++;
        updateCounter();
        checkProgress();
      });

      dragElement(el, el.querySelector(".head"));
    }

    let bigShown = false;
    let finalShown = false;

    function checkProgress(){
      if(!bigShown && closedCount >= (totalToClose - 1)){
        bigShown = true;
        setTimeout(createBigPopup, 250);
        return;
      }

      if(bigShown && !finalShown && closedCount >= totalToClose){
        finalShown = true;
        setTimeout(() => overlay.style.display = "flex", 250);
        // ‚úÖ N√ÉO coloca is-dodging aqui. Ele come√ßa normal.
      }
    }

    function dragElement(el, handle){
      let startX=0, startY=0, startLeft=0, startTop=0, dragging=false;

      handle.addEventListener("mousedown", (e) => {
        dragging=true;
        handle.style.cursor="grabbing";
        el.style.zIndex = z++;
        startX = e.clientX;
        startY = e.clientY;
        const rect = el.getBoundingClientRect();
        startLeft = rect.left;
        startTop  = rect.top;
        e.preventDefault();
      });

      window.addEventListener("mousemove", (e) => {
        if(!dragging) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        const newLeft = Math.min(window.innerWidth - el.offsetWidth - 8, Math.max(8, startLeft + dx));
        const newTop  = Math.min(window.innerHeight - el.offsetHeight - 8, Math.max(60, startTop + dy));
        el.style.left = newLeft + "px";
        el.style.top  = newTop + "px";
      });

      window.addEventListener("mouseup", () => {
        if(!dragging) return;
        dragging=false;
        handle.style.cursor="grab";
      });
    }

    function start(){
      hint.style.display = "none";
      overlay.style.display = "none";
      document.getElementById("encoreOverlay").style.display = "none";
      note.textContent = "";
      yesBtn.disabled = false;
      thinkBtn.disabled = false;

      // ‚úÖ garante que volta ao normal no restart
      thinkBtn.classList.remove("is-dodging");
      thinkBtn.style.left = "";
      thinkBtn.style.top = "";
      thinkBtn.style.transform = "";

      if(soundOn){
        bgMusic.volume = 0.35;
        bgMusic.play().catch(()=>{});
      }

      closedCount = 0;
      bigShown = false;
      finalShown = false;

      document.querySelectorAll(".popup").forEach(p => p.remove());

      const smallCount = Math.max(8, TARGET_POPUPS - 1);
      totalToClose = smallCount + 1;
      updateCounter();

      const pool = [];
      for(let i=0; i<smallCount; i++){
        pool.push(messages[i % messages.length]);
      }

      pool.forEach((m, i) => {
        setTimeout(() => createPopup(m, i), POPUPS_DELAY_MS * i);
      });
    }

    startBtn.addEventListener("click", async () => {
      if(!soundOn){
        try{
          bgMusic.volume = 0.35;
          await bgMusic.play();
          soundOn = true;
          setSoundUI();
        }catch(e){}
      }
      start();
    });

    function showEncore(){
      const encore = document.getElementById("encoreOverlay");
      encore.style.display = "flex";
      playSfxSafe(crowdCheer, { volume: 0.85 });
      setTimeout(() => playSfxSafe(applause, { volume: 0.75 }), 650);

      if(soundOn){
        const original = bgMusic.volume;
        bgMusic.volume = Math.min(0.55, original + 0.15);
        setTimeout(() => { bgMusic.volume = original; }, 2000);
      }
    }

    document.getElementById("encoreClose").addEventListener("click", () => {
      document.getElementById("encoreOverlay").style.display = "none";
      if(crowdCheer){ crowdCheer.pause(); crowdCheer.currentTime = 0; }
      if(applause){ applause.pause(); applause.currentTime = 0; }
    });

    yesBtn.addEventListener("click", () => {
      note.textContent = "Ent√£o vem c√°‚Ä¶ agora √© oficialmente n√≥s dois üíò";
      yesBtn.disabled = true;
      thinkBtn.disabled = true;
      setTimeout(showEncore, 350);
    });

    // ===== ‚úÖ BOT√ÉO FUGINDO SEM PASSAR POR CIMA DO SIM =====
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function rectsOverlap(a, b){
      return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
    }

    function moveThinkButton(){
      if(!thinkBtn || !finalActions || !yesBtn) return;

      thinkBtn.classList.add("is-dodging");

      const boxRect = finalActions.getBoundingClientRect();
      const yesRect = yesBtn.getBoundingClientRect();

      const bw = thinkBtn.offsetWidth;
      const bh = thinkBtn.offsetHeight;

      const padding = 8;

      const minX = padding;
      const maxX = Math.max(padding, boxRect.width - bw - padding);
      const minY = padding;
      const maxY = Math.max(padding, boxRect.height - bh - padding);

      // √°rea do SIM em coordenadas locais
      const yesLocal = {
        left: yesRect.left - boxRect.left - 6,
        top: yesRect.top - boxRect.top - 6,
        right: yesRect.right - boxRect.left + 6,
        bottom: yesRect.bottom - boxRect.top + 6
      };

      let x = minX, y = minY;

      for(let i=0; i<20; i++){
        const rx = clamp(Math.random() * maxX, minX, maxX);
        const ry = clamp(Math.random() * maxY, minY, maxY);

        const thinkLocal = { left: rx, top: ry, right: rx + bw, bottom: ry + bh };
        if(!rectsOverlap(thinkLocal, yesLocal)){
          x = rx; y = ry;
          break;
        }
      }

      thinkBtn.style.left = `${x}px`;
      thinkBtn.style.top  = `${y}px`;

      if(note) note.textContent = "Eita‚Ä¶ esse bot√£o t√° t√≠mido üò≥";
    }

    // foge quando chega perto / tenta clicar
    thinkBtn.addEventListener("mouseenter", moveThinkButton);
    thinkBtn.addEventListener("mousedown", (e) => { e.preventDefault(); moveThinkButton(); });
    thinkBtn.addEventListener("touchstart", (e) => { e.preventDefault(); moveThinkButton(); }, { passive:false });

    setSoundUI();
    updateCounter();
  </script>
</body>
</html>
